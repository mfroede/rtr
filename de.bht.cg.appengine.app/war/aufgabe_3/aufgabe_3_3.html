<!--
A WebGL example using tdl.js (http:// code.google.com/p/threedlibrary/).

author: Henrik Tramberend (tramberend@beuth-hochschule.de)
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" 
  "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>WebGL using tdl.js</title>
<script type="text/javascript" src="../resources/tdl/base.js"></script>
<script type="text/javascript" src="../resources/tdl/gl-matrix.js"></script>

<script src="../resources/common/jquery-1.7.1.min.js"></script>

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- <link rel="stylesheet" type="text/css" href="../resources/common/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="../resources/common/bootstrap/css/b1234ootstrap-responsive.min.css"> -->
<link rel="stylesheet" href="../resources/css/style.css" />

<script type="text/javascript" src="aufgabe_3_3.js"></script>
</head>

<body>

   <input class='backButton' type="button" value="back" onclick="javascript:history.back()">
   <div class="subpagetitle"
      style='opacity: 0.8; margin-left: auto; margin-right: auto; display: block; text-align: center; position: relative;'>Aufgabe
      3.3: WebGL Illuminated Spheres</div>
   <canvas id="canvas" width="800" height="450" style='margin-left: auto; margin-right: auto; display: block;'></canvas>

   <div class='slide-content' style='margin-left: auto; margin-right: auto; display: block;'>
      <div class='slide-description' style='width: 800px; display: block; margin-left: auto; margin-right: auto;'>
         <h3 style='margin: 15px 15px;'>Bedienung der Anwendung</h3>
         <p>Number of Circle: <input id="circlenumber" onchange='render()' value="5" size="2" maxlength="5" type="text"></input></p>
         <p>Radius of Circle: <input id="circleradius" onchange='render()' value="0.8" size="2" maxlength="5" type="text"></input></p>
         <p>Color of Circle: <input id="circlecolor" onchange='render()' value="255, 0, 0" size="5" maxlength="50" type="text"></input></p>
         <p>Color of Cube: <input id="cubecolor" onchange='render()' value="0, 0, 255" size="5" maxlength="50" type="text"></input></p>
         <p>Edge length of Cube: <input id="cubelength" onchange='initialize()' value="0.7" size="2" maxlength="5" type="text"></input></p>
         <br><p>"q" - Ansicht mit Kugel-Textur</p>
         <p>"w" - Ansicht mit Toonshader</p>
         <p>"s" - Ein-/Ausschalten der Rotation</p>
      </div>
   </div>

   <div class='slide-content' style='margin-left: auto; margin-right: auto; display: block;'>
      <div class='slide-description' style='width: 800px; display: block; margin-left: auto; margin-right: auto;'>
         <h3 style='margin: 15px 15px;'>Erläuterung des Lösungsansatzes</h3>

      </div>
   </div>

   <div class="container">
      <div class="page-header">
         <h1>WebGL Illuminated Spheres</h1>
      </div>

      <pre id="error" class="alert alert-error"></pre>

      <h2>Resources</h2>
      <ul>
         <li>Uses <a href="http://code.google.com/p/threedlibrary/">TDL</a> as a low-level WebGL support library.
         </li>
      </ul>
   </div>
</body>

<!--cell shader bubble texture-->

<script id="vs4" type="text/glsl">
uniform mat4 projection;
uniform mat4 view;
uniform mat4 model; 
uniform float time;

uniform vec3 lightPositions[8];
uniform vec3 eyePosition;

attribute vec4 position;
attribute vec3 normal;
attribute vec2 texCoord;

varying vec3 normalW;
varying vec3 lightDirectionsW[8];
varying vec3 eyeDirectionW;
varying vec2 texCoordI;

void main() {
  vec4 positionW = model * position;
  normalW = (model * vec4(normal, 0.0)).xyz;
  for(int i=0; i<8; i++) {
    lightDirectionsW[i] = lightPositions[i] - positionW.xyz;
  }
  eyeDirectionW = eyePosition - positionW.xyz;

  gl_Position = projection * view * positionW;
  texCoordI = texCoord;
}
</script>

<script id="fs4" type="text/glsl">
precision highp float;

uniform vec3 color;
uniform vec3 lightIntensities[8];
uniform float radius;
uniform float number;
uniform vec3 circleColor;
uniform vec3 backround;
uniform bool circleTexture;

varying vec3 normalW;
varying vec3 lightDirectionsW[8];
varying vec3 eyeDirectionW;
varying vec2 texCoordI;

vec3 toon(vec3 normal, vec3 eye, vec3 light, vec3 lightIntensity, vec3 color) {
    float intensity = max(dot(light, normal), 0.0);
    if(intensity < 0.2) {
        return vec3(0.0, 0.0, 0.0);
    }
    vec3 resultColor;
    float specular = pow(max(0.0, dot(normal,light)), 30.0);
    if (specular < 0.2) {
        resultColor = color * 0.8;
	} else {
		resultColor = lightIntensity;
	}
	float diffuse = dot(normal,light);
   	if (diffuse < 0.5) {
		resultColor *= 0.8;
	}
	return resultColor * lightIntensity;
}

float oscillation(float x, float num){    
    return 2.0 / 3.14159 * asin(cos(3.14159 * x * num));
}

vec3 generateColor(){
    if(oscillation(texCoordI.x, number) * oscillation(texCoordI.x, number) + oscillation(texCoordI.y, number) * oscillation(texCoordI.y, number) <= radius * radius){
        return circleColor;
    } else {
        return backround;
    }
}

void main() {
    vec3 formColor = color;
    if(circleTexture){
        formColor = generateColor();
    }    

    vec3 newcolor = vec3(0,0,0);
    for(int i = 0; i < 8; i++) {
       newcolor +=  toon(normalize(normalW), normalize(eyeDirectionW), normalize(lightDirectionsW[i]), lightIntensities[i], formColor);
    }
    gl_FragColor = vec4(newcolor, 1.0);
}
</script>
<!--EOF: cell shader bubble texture-->

<!--cell shader -->

<script id="vs4" type="text/glsl">
uniform mat4 projection;
uniform mat4 view;
uniform mat4 model; 
uniform float time;

uniform vec3 lightPosition;
uniform vec3 eyePosition;

attribute vec4 position;
attribute vec3 normal;
attribute vec2 texCoord;

varying vec3 normalW;
varying vec3 lightDirectionW;
varying vec3 eyeDirectionW;
varying vec2 texCoordI;

void main() {
  vec4 positionW = model * position;
  normalW = (model * vec4(normal, 0.0)).xyz;
  lightDirectionW = lightPosition[0] - positionW.xyz;
  eyeDirectionW = eyePosition - positionW.xyz;

  gl_Position = projection * view * positionW;
  texCoordI = texCoord;
}
</script>

<script id="fs4" type="text/glsl">
precision highp float;

uniform vec3 color;
uniform vec3 lightIntensity;

varying vec3 normalW;
varying vec3 lightDirectionW;
varying vec3 eyeDirectionW;
varying vec2 texCoordI;

vec3 toon(vec3 normal, vec3 eye, vec3 light, vec3 color) {
    float intensity = max(dot(light, normal), 0.0);
    if(intensity < 0.2) {
        return vec3(0.0, 0.0, 0.0);
    }
    vec3 resultColor;
    float specular = pow(max(0.0, dot(normal,light)), 30.0);
    if (specular < 0.2) {
        resultColor = color * 0.8;
    } else {
        resultColor = lightIntensity;
    }
    float diffuse = dot(normal,light);
    if (diffuse < 0.5) {
        resultColor *= 0.8;
    }
    return resultColor;
}

void main() {
    vec3 newcolor = toon(normalize(normalW), normalize(eyeDirectionW), normalize(lightDirectionW), color);
    gl_FragColor = vec4(newcolor, 1.0);
}
</script>
<!--EOF: cell shader -->


</html>
